<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace는 map파일을 구분하는 유일한 속성 -> 서버에서 겹치면 안됨, 유일해야함  -->
<!-- 인터페이스를 mapper화 할 경우 인터페이스 클래스명과 mapper파일명이 일치해야함 -->
<!-- 또한 namespace는 인터페이스의 풀패키지경로와 동일하게 지정해주어야 함 -->
<!-- 인터페이스를 mapper화 해서 사용할 경우 인터페이스의 인자값을 자동으로 받아와 바인딩하므로 parameterType 지정을 할 필요가 없음 -->
<mapper namespace="com.kosmo.mapper.ApplyFarmMapper">

<!-- 리절트 맵 정의 -> property는 vo의 프로퍼티, column은 DB의 컬럼과 일치 -> 컬럼이름과 일치하는 데이터를 프로퍼티에 넣는 설정을 맵형태로 설정함  -->
<!-- vo프로퍼티와 컬럼명이 다르면 자동으로 get,set가 되지 않으므로 리절트맵을 이용함 -->
<!-- 다른효과도많음...나중에 -->
<!-- association -> 1:1관계 -->
<!-- collection 1:다 관계 -->
<resultMap id="farmlist" type="java.util.HashMap">
	<result property="fgname" column="fgname" />
	<result property="fgseq" column="fgseq" />
</resultMap>

<resultMap id="farmarea" type="java.util.HashMap">
	<result property="fgcol" column="fgcol" />
	<result property="fgrow" column="fgrow" />
	<result property="fgtotalarea" column="fgtotalarea" />
</resultMap>

  <!--
	<resultMap id="BoardReplyForMap" type="com.board.board.BoardVO">
		
		<result property="bseq" column="bseq" />
		<result property="btype" column="btype" />
		<result property="btitle" column="btitle" />
		<result property="bcon" column="bcon" />
		<result property="mseq" column="mseq" />
		<result property="filepath" column="filepath" />
		<result property="filename" column="filename" />
		<result property="filesize" column="filesize" />
		<result property="bregdate" column="bregdate" />
		    
		<collection property="rlist" resultMap="BoardReplyMap" columnPrefix="r_" />
		
		 
		<collection property="rlist" columnPrefix="r_" ofType="com.board.board.BoardReplyVO">
			<result property="rseq" column="rseq" />
			<result property="mseq" column="mseq" />
			<result property="reply" column="reply" />
			<result property="regdate" column="regdate" />
		</collection>
		
		
	</resultMap>
	
	<resultMap id="BoardReplyMap" type="com.board.board.BoardReplyVO">
		<result property="rseq" column="rseq" />
		<result property="mseq" column="mseq" />
		<result property="reply" column="reply" />
		<result property="regdate" column="regdate" />
	</resultMap>

	<resultMap id="BoardMap" type="com.board.board.BoardVO">
		<result property="bseq" column="bseq" />
		<result property="btype" column="btype" />
		<result property="btitle" column="btitle" />
		<result property="bcon" column="bcon" />
		<result property="mseq" column="mseq" />
		<result property="filepath" column="filepath" />
		<result property="filename" column="filename" />
		<result property="filesize" column="filesize" />
		<result property="bregdate" column="bregdate" />
	</resultMap>
 매퍼파일안의 id는 해당 xml파일 안에서만 겹치지 않으면 됨 -->

<select id="checkMyFarm" resultType="int">
	select count(1) as count from apply where mseq=#{mseq} and year=#{year} and apcancel='n'
</select>

<select id="selectFarmLocation" resultType="String">
	select fglocation from farm_garden where fgdivision = '농장' group by fglocation
</select>

<select id="selectFarmName" resultMap="farmlist">
	select fgname, fgseq from farm_garden where fglocation = #{fglocation} and fgdivision ='농장' group by fgname, fgseq
</select>

<select id="selectFarmArea" resultMap="farmarea">
	select fgcol, fgrow, fgtotalarea from farm_garden where fgseq = #{fgseq}
</select>

<insert id="completeApply">
	insert into apply (apseq, mseq, fgseq, aseq, year, pdivision, pcode, awinner, apname, apphone, apemail, apbirth, apdate, apcancel)
    values(apply_seq.nextval, #{mseq},#{fgseq},#{aseq},#{year},#{pdivision},#{pcode},'y',#{apname},#{apphone},#{apemail},#{apbirth}, sysdate,'n') 
</insert>

<insert id="insertAreaNO">
	insert into area (aseq, fgseq) values (#{aseq}, #{fgseq})
</insert>

<!--
-->
</mapper>