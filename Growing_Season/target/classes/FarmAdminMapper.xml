<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kosmo.mapper.FarmAdminMapper">

<resultMap id="MemberMap" type="com.kosmo.farmadmin.MemberVO" >
		<id property="mseq" column="mseq" />
		<result property="mid" column="mid" />
		<result property="mphone" column="mphone" />
		<result property="mpw" column="mpw" />
		<result property="mname" column="mname" />
		<result property="mbirth" column="mbirth" />
		<result property="memail" column="memail" />
		<result property="maddress" column="maddress" />
		<result property="mgender" column="mgender" />
		<association property="avo"  javaType="com.kosmo.farmadmin.ApplyVO">
			<id property="apseq" column="apseq" /> 
			<result property="apname" column="apname" />
			<result property="apphone" column="apphone" />
			<result property="apemail" column="apemail" />
			<result property="apbirth" column="apbirth" />
			<result property="apdivision" column="apdivision" />
		</association>
		<collection property="dvoList" javaType = "java.util.ArrayList" ofType="com.kosmo.farmadmin.DocumentVO">
			<id property="dseq" column="dseq" />
			<result property="dfilename" column="dfilename" />
		</collection>
</resultMap>

<resultMap id="UsingMap" type="com.kosmo.farmadmin.MemberVO" >
		<result property="mseq" column="mseq" />
		<result property="mid" column="mid" />
		<result property="mphone" column="mphone" />
		<result property="mpw" column="mpw" />
		<result property="mname" column="mname" />
		<result property="mbirth" column="mbirth" />
		<result property="memail" column="memail" />
		<result property="maddress" column="maddress" />
		<result property="mgender" column="mgender" />
		<association property="avo"  javaType="com.kosmo.farmadmin.ApplyVO">
			<id property="apseq" column="apseq" /> 
			<result property="apname" column="apname" />
			<result property="apphone" column="apphone" />
			<result property="apemail" column="apemail" />
			<result property="apbirth" column="apbirth" />
			<result property="apdivision" column="apdivision" />
		</association>
		<association property="fgvo" javaType = "com.kosmo.farmadmin.FarmGardenVO" >
			<id property="fgseq" column="fgseq" />
			<result property="fglocation" column="fglocation" />
			<result property="fgname" column="fgname" />
			<result property="fgtotalarea" column="fgtotalarea" />
			<result property="fgdivision" column="fgdivision" />
			<result property="fgdetaildiv" column="fgdetaildiv" />
		</association>
</resultMap>

<resultMap id="AreaMap" type="com.kosmo.farmadmin.ApplyVO" >
		<id property="apseq" column="apseq" /> 
		<result property="mseq" column="mseq" />
		<result property="fgseq" column="fgseq" />
		<result property="aseq" column="aseq" />
		<result property="year" column="year" />
		<result property="pdivision" column="pdivision" />
		<result property="pcode" column="pcode" />
		<result property="awinner" column="awinner" />
		<result property="apname" column="apname" />
		<result property="apphone" column="apphone" />
		<result property="apemail" column="apemail" />
		<result property="apbirth" column="apbirth" />
		<result property="apdate" column="apdate" />
		<result property="apcancel" column="apcancel" />
		<result property="apdivision" column="apdivision" />
		<association property="fgvo" javaType = "com.kosmo.farmadmin.FarmGardenVO" >
			<id property="fgseq" column="fgseq" />
			<result property="fgdivision" column="fgdivision" />
			<result property="fgdetaildiv" column="fgdetaildiv" />
			<result property="fglocation" column="fglocation" />
			<result property="fgname" column="fgname" />
			<result property="fgtotalarea" column="fgtotalarea" />
		</association>
</resultMap>


<!-- <resultMap id="FarmGardenMap" type="com.kosmo.farmadmin.FarmGardenVO" >
		<result property="fgseq" column="fgseq" />
		<result property="fgdivision" column="fgdivision" />
		<result property="fgdetaildiv" column="fgdetaildiv" />
		<result property="fglocation" column="fglocation" />
		<result property="fgname" column="fgname" />
		<result property="fgmanager" column="fgmanager" />
		<result property="fgaddress" column="fgaddress" />
		<result property="fgphone" column="fgphone" />
</resultMap> -->

<select id="applyList" resultMap="MemberMap" parameterType="com.kosmo.farmadmin.MemberVO">
<![CDATA[
select ad.rnum, ad.apdivision ,ad.mseq, ad.apname, ad.apbirth, m.mgender, m.maddress, ad.apphone, ad.apemail, ad.dfilename, ad.apseq
from member m right outer join (select rownum rnum,a.apseq ,a.mseq, a.apdivision, a.apname, a.apbirth, a.apphone, a.apemail, d.dfilename
from apply a left outer join document d on a.apseq = d.apseq) ad on m.mseq=ad.mseq
where ad.apdivision != '농장' and ad.rnum >=#{sseq} and ad.rnum <=#{eseq}
order by m.mseq
]]>
</select>

<select id="applyListCount" resultType="int">
select count(*) as totalcount 
from member m 
left outer join (select mseq, apdivision from apply) a on m.mseq =a.mseq
where a.apdivision != '농장' 
</select>

<select id="farmlocationList" resultType="com.kosmo.farmadmin.FarmGardenVO" parameterType="com.kosmo.farmadmin.FarmGardenVO">
select fglocation from farm_garden
group by fglocation
order by fglocation
</select>

<select id="farmnameList" resultType="com.kosmo.farmadmin.FarmGardenVO" parameterType="com.kosmo.farmadmin.FarmGardenVO">
select fgname from farm_garden
order by fgname
</select>

<select id="fList" resultType="com.kosmo.farmadmin.FarmGardenVO" parameterType="com.kosmo.farmadmin.FarmGardenVO">
select * from farm_garden
order by fgseq
</select>

<select id="searchlocList" resultType="com.kosmo.farmadmin.FarmGardenVO">
select fgseq, fgname, fglocation from farm_garden
where fglocation = #{fglocation}
</select>

<select id="searchfarmList" resultType="com.kosmo.farmadmin.FarmGardenVO">
select * from farm_garden
where fgseq = #{fgseq}
</select>

<select id="silverDivCount" resultType="int">
select sum(fgtotalarea) from farm_garden
where fgdivision = '텃밭' and fgdetaildiv = '실버'
</select>

<select id="silverApplyCount" resultType="com.kosmo.farmadmin.ApplyVO" parameterType="com.kosmo.farmadmin.ApplyVO">
select apseq from apply
where apdivision='실버'
</select>

<select id="manyBabyDivCount" resultType="int">
select sum(fgtotalarea) from farm_garden
where fgdivision = '텃밭' and fgdetaildiv = '다둥이'
</select>

<select id="manyBabyApplyCount" resultType="com.kosmo.farmadmin.ApplyVO" parameterType="com.kosmo.farmadmin.ApplyVO">
select apseq from apply
where apdivision='다둥이'
</select>

<select id="manyCultureDivCount" resultType="int">
select sum(fgtotalarea) from farm_garden
where fgdivision = '텃밭' and fgdetaildiv = '다문화'
</select>

<select id="manyCultureApplyCount" resultType="com.kosmo.farmadmin.ApplyVO" parameterType="com.kosmo.farmadmin.ApplyVO">
select apseq from apply
where apdivision='다문화'
</select>

<select id="lottoList" resultType="com.kosmo.farmadmin.ApplyVO" parameterType="com.kosmo.farmadmin.ApplyVO">
<![CDATA[
select rnum, apdivision, apseq, mseq , apname, apphone, apemail, apdate, awinner, apcancel from
(select rownum rnum, apdivision, apseq, mseq , apname, apphone, apemail, apdate, awinner, apcancel 
from apply 
where awinner='Y' order by apdivision)
where rnum >=#{sseq} and rnum <=#{eseq}
]]>
</select>

<select id="lottoListCount" resultType="int">
select count(1) from (select apdivision, apseq, mseq , apname, apphone, apemail, apdate, awinner, apcancel 
from apply 
where awinner='Y'
order by apdivision)
</select>

<select id="usingList" resultMap="UsingMap" parameterType="com.kosmo.farmadmin.MemberVO">
select *
from member m left outer join (select *
from apply a right outer join farm_garden fg on a.fgseq = fg.fgseq) afg on m.mseq = afg.mseq
where afg.fglocation = #{fgvo.fglocation} and afg.fgname = #{fgvo.fgname}
</select>

<select id="areaList" resultMap="AreaMap" parameterType="com.kosmo.farmadmin.ApplyVO">
select *
from apply a left outer join farm_garden fg on a.fgseq = fg.fgseq
where fg.fgseq=#{fgseq}
</select>

<insert id="farmInsert" parameterType="com.kosmo.farmadmin.FarmGardenVO" >
insert into farm_garden
values(farmgarden_seq.nextval, #{fgdivision}, #{fgdetaildiv}, #{fglocation}, #{fgname}, #{fgmanager}, #{fgaddress}, #{fgphone}, #{fgfeature}, #{fgguide}, #{fgcol}, #{fgrow}, #{fgtotalarea},'','','n')
</insert>

<delete id="farmDelete" parameterType="com.kosmo.farmadmin.FarmGardenVO">
delete from farm_garden where fgseq=#{fgseq}
</delete>

<update id="farmUpdate" parameterType="com.kosmo.farmadmin.FarmGardenVO">
update farm_garden set fglocation=#{fglocation}, fgname=#{fgname}, fgaddress=#{fgaddress}, fgphone=#{fgphone}, fgmanager=#{fgmanager} where fgseq=#{fgseq}
</update>

<update id="silverLotto" parameterType="com.kosmo.farmadmin.ApplyVO">
update apply set awinner='Y' where apseq=#{apseq}
</update>

<update id="manyBabyLotto" parameterType="com.kosmo.farmadmin.ApplyVO">
update apply set awinner='Y' where apseq=#{apseq}
</update>

<update id="manyCultureLotto" parameterType="com.kosmo.farmadmin.ApplyVO">
update apply set awinner='Y' where apseq=#{apseq}
</update>

</mapper>