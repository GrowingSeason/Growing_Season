<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.kosmo.mapper.BoardMapper">

<!-- 
<resultMap id="myBoardMap" type="com.kosmo.board.BoardVO">
	<result property="mseq" column="mseq" />
	<result property="mtitle" column="mtitle" />
</resultMap>
 -->

	<resultMap id="brListMap" type="com.kosmo.board.BoardVO">
		<result property="bseq" column="bseq"/>
		<result property="btype" column="btype"/>
		<result property="btitle" column="btitle"/>
		<result property="bcon" column="bcon"/>
		<result property="mseq" column="mseq"/>
		<result property="bfile_path" column="bfile_path"/>
		<result property="bfile_name" column="bfile_name"/>
		<result property="bfile_size" column="bfile_size"/>
		<result property="regdate" column="regdate"/>
		
		<collection property="rlist" resultMap="rListMap"/>
	</resultMap>
	
	<resultMap id="rListMap" type="com.kosmo.board.BoardReplyVO">
		<result property="rseq" column="rseq"/>
		<result property="reply" column="reply"/>
		<result property="regdate" column="regdate"/>
		<result property="bseq" column="bseq"/>
		<result property="mseq" column="mseq"/>
	</resultMap>
	
	<resultMap id="chartListMap" type="com.kosmo.board.ChartVO">
		<result property="category" column="category"/>
		<result property="price" column="price"/>
	</resultMap>
	

	<select id="chartSet" resultType="com.kosmo.board.ChartVO" resultMap="chartListMap">
		select category, sum(price) as price from sample group by category
	</select>

	<select id="brList" resultType="com.kosmo.board.BoardVO" resultMap="brListMap">
		select b.bseq,b.btype,b.btitle,b.bcon,b.mseq,b.bfile_path,b.bfile_name,b.bfile_size,b.regdate,
		r.rseq, r.reply, r.regdate, r.bseq, r.mseq
		from board b, board_reply r
		where b.bseq=r.bseq(+) 
		order by b.bseq desc
	</select>
	


	<select id="boardCount"
	resultType="Integer">
		select count(*) cnt from board
	</select>
	
	


	<select id="boardListForSearch"
	parameterType="com.kosmo.board.BoardVO"
	resultType="com.kosmo.board.BoardVO">
	<!-- '%' ||  #{keyword} || '%' -->
		select rnum, bseq,btype,btitle,bcon,mseq,bfile_path,bfile_name,bfile_size,regdate
		from
		(
		    select  rownum rnum, bseq,btype,btitle,bcon,mseq,bfile_path,bfile_name,bfile_size, regdate
		    from
		        (select bseq,btype,btitle,bcon,mseq,bfile_path,bfile_name,bfile_size,to_char(regdate, 'YYYY-MM-DD') regdate from board
		  		where  ${searchGubun}  like '%' ||  #{searchStr} || '%'
		  		order by regdate desc) t
		)
		where rnum <![CDATA[>=]]> #{sseq} and rnum <![CDATA[<=]]> #{eseq}
	</select>


		<select id="boardList"
	parameterType="com.kosmo.board.BoardVO"
	resultType="com.kosmo.board.BoardVO">
		select rnum, bseq,btype,btitle,bcon,mseq,bfile_path,bfile_name,bfile_size,regdate
		from
		(
		    select  rownum rnum, bseq,btype,btitle,bcon,mseq,bfile_path,bfile_name,bfile_size, regdate
		    from
		        (select bseq,btype,btitle,bcon,mseq,bfile_path,bfile_name,bfile_size,to_char(regdate, 'YYYY-MM-DD') regdate from board order by bseq desc) t
		)
		where rnum <![CDATA[>=]]> #{sseq} and rnum <![CDATA[<=]]> #{eseq}
	</select>


	<select id="boardDetail"
	parameterType="int"
	resultType="com.kosmo.board.BoardVO"
	resultMap="brListMap">
	
		select b.bseq,b.btype,b.btitle,b.bcon,b.mseq,b.bfile_path,b.bfile_name,b.bfile_size,b.regdate,
		r.rseq, r.reply, r.regdate, r.bseq, r.mseq
		from board b, board_reply r
		where b.bseq=r.bseq(+) 
		and b.bseq = #{bseq}
		
	</select>

	<insert id="boardInsert"
	parameterType="com.kosmo.board.BoardVO">
		insert
		into board(bseq,btype,btitle,bcon,mseq,bfile_path,bfile_name,bfile_size,regdate)
		values(board_seq.nextval , #{btype},#{btitle},#{bcon},#{mseq},#{bfile_path},#{bfile_name},#{bfile_size}, sysdate)
		<!--
		,#{bfile_path, jdbcType=VARCHAR}
		,#{bfile_name, jdbcType=VARCHAR}
		,#{bfile_size, jdbcType=INTEGER}
		 -->
	</insert>

	<update id="boardUpdateForUpload"
	parameterType="com.kosmo.board.BoardVO">
		update board
		set
			btitle=#{btitle}
			,bcon=#{bcon}
			,bfile_path=#{bfile_path}
			,bfile_name=#{bfile_name}
			,bfile_size=#{bfile_size}
		where bseq=#{bseq}
	</update>

	<update id="boardUpdate"
	parameterType="com.kosmo.board.BoardVO">
		update board
		set
			btitle=#{btitle}
			,bcon=#{bcon}
		where bseq=#{bseq}
	</update>


	<update id="boardDelete"
	parameterType="Integer">
		delete from board
		where bseq=#{bseq}
	</update>

</mapper>
